{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">

      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
      <link rel="stylesheet" href="{% static 'commentA.css' %}">

      <title>Document</title>
</head>
<body>
      <div class="container">
            <div class="row my-v justify-content-center vertical-center">
                  <div class="col-sm-6">
                        <div class="card">
                              <div class="card-header">
                              add comment
                              </div>
                              <div class="card-body" id="wrapper">
                                    <form method="post">
                                          {% csrf_token %}
                                          <label for="title">title</label>
                                          <input type="text" id="title-id" class="form-control" name="title">
                                          <label for="content-id">comment</label>
                                          <textarea class="form-control" name="content" id="content-id" cols="30" rows="10" style="resize: none;"></textarea>
                                          <br>
                                          <a href="/" class="btn btn-primary fw-bold">Cancel</a>
                                          <button id="submit" class="btn btn-primary fw-bold">Edit</button>
                                    </form>
                              </div>
                        </div>
                  </div>
            </div>
      </div>

      <script>

            function getCookie(name) {
		    var cookieValue = null;
		    if (document.cookie && document.cookie !== '') {
		        var cookies = document.cookie.split(';');
		        for (var i = 0; i < cookies.length; i++) {
		            var cookie = cookies[i].trim();
		            // Does this cookie string begin with the name we want?
		            if (cookie.substring(0, name.length + 1) === (name + '=')) {
		                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
		                break;
		            }
		        }
		    }
		    return cookieValue;
		}
		var csrftoken = getCookie('csrftoken');

            var form = document.getElementById('wrapper')
            var user_id = '{{ request.user.id }}'

            form.addEventListener('submit', function(e){
                  e.preventDefault()
                  var url = 'http://127.0.0.1:8000/api/comment-edit/' + "{{ id }}"
                  var title = document.getElementById('title-id').value
                  var content = document.getElementById('content-id').value

                  fetch(url, {
                        method: 'POST',
                        headers: {
                              'Content-type': 'application/json',
                              'X-CSRFToken': csrftoken
                        },
                        body: JSON.stringify({'title': title, 'content': content, 'user': user_id})
                  }
                  ).then(function(response){
                  window.location.href = '/'

            })
            })
      

      </script>

</body>
</html>